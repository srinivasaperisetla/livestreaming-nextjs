{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/app/services/transcriptionService.ts"],"sourcesContent":["import { GoogleGenerativeAI } from \"@google/generative-ai\";\n\nconst genAI = new GoogleGenerativeAI(process.env.NEXT_PUBLIC_GEMINI_API_KEY || '');\nconst MODEL_NAME = \"gemini-1.5-flash-8b\";\n\nexport class TranscriptionService {\n  private model;\n\n  constructor() {\n    this.model = genAI.getGenerativeModel({ model: MODEL_NAME });\n  }\n\n  async transcribeAudio(audioBase64: string, mimeType: string = \"audio/wav\"): Promise<string> {\n    try {\n      const result = await this.model.generateContent([\n        {\n          inlineData: {\n            mimeType: mimeType,\n            data: audioBase64\n          }\n        },\n        { text: \"Please transcribe the spoken language in this audio accurately. Ignore any background noise or non-speech sounds.\" },\n      ]);\n\n      return result.response.text();\n    } catch (error) {\n      console.error(\"Transcription error:\", error);\n      throw error;\n    }\n  }\n} "],"names":[],"mappings":";;;AAAA;AAEqC;;AAArC,MAAM,QAAQ,IAAI,iKAAA,CAAA,qBAAkB,CAAC,+EAA0C;AAC/E,MAAM,aAAa;AAEZ,MAAM;IACH,MAAM;IAEd,aAAc;QACZ,IAAI,CAAC,KAAK,GAAG,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAW;IAC5D;IAEA,MAAM,gBAAgB,WAAmB,EAAE,WAAmB,WAAW,EAAmB;QAC1F,IAAI;YACF,MAAM,SAAS,MAAM,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC;gBAC9C;oBACE,YAAY;wBACV,UAAU;wBACV,MAAM;oBACR;gBACF;gBACA;oBAAE,MAAM;gBAAoH;aAC7H;YAED,OAAO,OAAO,QAAQ,CAAC,IAAI;QAC7B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wBAAwB;YACtC,MAAM;QACR;IACF;AACF"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/app/utils/audioUtils.ts"],"sourcesContent":["// Helper function to download and analyze WAV data\nfunction debugSaveWav(wavData: string, filename: string = 'debug.wav') {\n  const byteString = atob(wavData);\n  const bytes = new Uint8Array(byteString.length);\n  for (let i = 0; i < byteString.length; i++) {\n    bytes[i] = byteString.charCodeAt(i);\n  }\n  \n  // Create blob and download for test\n  const blob = new Blob([bytes], { type: 'audio/wav' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\nexport function pcmToWav(pcmData: string, sampleRate: number = 24000): Promise<string> {\n  return new Promise((resolve, reject) => {\n    try {\n      // Decode base64 PCM data\n      const binaryString = atob(pcmData);\n      const pcmBytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        pcmBytes[i] = binaryString.charCodeAt(i);\n      }\n\n      // Convert bytes to samples (assuming 16-bit PCM)\n      const samples = new Int16Array(pcmBytes.buffer);\n\n      // Create WAV header\n      const wavHeader = new ArrayBuffer(44);\n      const view = new DataView(wavHeader);\n\n      const pcmByteLength = samples.length * 2; // 16-bit = 2 bytes per sample\n\n      // \"RIFF\" chunk descriptor\n      view.setUint8(0, 'R'.charCodeAt(0));\n      view.setUint8(1, 'I'.charCodeAt(0));\n      view.setUint8(2, 'F'.charCodeAt(0));\n      view.setUint8(3, 'F'.charCodeAt(0));\n\n      // File length (header size + data size)\n      view.setUint32(4, 36 + pcmByteLength, true);\n\n      // \"WAVE\" format\n      view.setUint8(8, 'W'.charCodeAt(0));\n      view.setUint8(9, 'A'.charCodeAt(0));\n      view.setUint8(10, 'V'.charCodeAt(0));\n      view.setUint8(11, 'E'.charCodeAt(0));\n\n      // \"fmt \" sub-chunk\n      view.setUint8(12, 'f'.charCodeAt(0));\n      view.setUint8(13, 'm'.charCodeAt(0));\n      view.setUint8(14, 't'.charCodeAt(0));\n      view.setUint8(15, ' '.charCodeAt(0));\n\n      // Sub-chunk size\n      view.setUint32(16, 16, true);\n      // Audio format (PCM = 1)\n      view.setUint16(20, 1, true);\n      // Number of channels\n      view.setUint16(22, 1, true);\n      // Sample rate\n      view.setUint32(24, sampleRate, true);\n      // Byte rate\n      view.setUint32(28, sampleRate * 2, true);\n      // Block align\n      view.setUint16(32, 2, true);\n      // Bits per sample\n      view.setUint16(34, 16, true);\n\n      // \"data\" sub-chunk\n      view.setUint8(36, 'd'.charCodeAt(0));\n      view.setUint8(37, 'a'.charCodeAt(0));\n      view.setUint8(38, 't'.charCodeAt(0));\n      view.setUint8(39, 'a'.charCodeAt(0));\n\n      // Data size\n      view.setUint32(40, pcmByteLength, true);\n\n      // Create final buffer\n      const wavBuffer = new ArrayBuffer(wavHeader.byteLength + pcmByteLength);\n      const wavBytes = new Uint8Array(wavBuffer);\n\n      // Copy header and PCM data\n      wavBytes.set(new Uint8Array(wavHeader), 0);\n      wavBytes.set(new Uint8Array(samples.buffer), wavHeader.byteLength);\n\n      // Use Blob and FileReader to convert to base64\n      const blob = new Blob([wavBytes], { type: 'audio/wav' });\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const base64data = reader.result?.toString().split(',')[1];\n        if (base64data) {\n          resolve(base64data);\n        } else {\n          reject(new Error(\"Failed to convert WAV to base64\"));\n        }\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    } catch (error) {\n      reject(error);\n    }\n  });\n} "],"names":[],"mappings":"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"}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/app/services/geminiWebSocket.ts"],"sourcesContent":["// import { Base64 } from 'js-base64';\nimport { TranscriptionService } from './transcriptionService';\nimport { pcmToWav } from '../utils/audioUtils';\n\nconst MODEL = \"models/gemini-2.0-flash-exp\";\nconst API_KEY = process.env.NEXT_PUBLIC_GEMINI_API_KEY;\nconst HOST = \"generativelanguage.googleapis.com\";\nconst WS_URL = `wss://${HOST}/ws/google.ai.generativelanguage.v1alpha.GenerativeService.BidiGenerateContent?key=${API_KEY}`;\n\n// Add proper types instead of any\ninterface LightValues {\n  brightness: number;\n  colorTemperature: string;\n}\n\nasync function setLightValues(brightness: number, colorTemp: string): Promise<LightValues> {\n  return {\n    brightness,\n    colorTemperature: colorTemp\n  };\n}\n\n// Add proper type for postal_code\nasync function fetchDoctors(postal_code: string) {\n  try {\n    const res = await fetch('/api/nppes', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ postal_code: postal_code }),\n    });\n\n    if (!res.ok) throw new Error('Failed to fetch');\n\n    const data = await res.json();\n    return data;\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nconst fetchDoctorsDeclaration = {\n  name: \"getDoctorsFromPostalCode\",\n  parameters: {\n    type: \"OBJECT\",\n    description: \"fetch the doctors from a specific postal code\",\n    properties: {\n      postal_code: {\n        type: \"NUMBER\",\n        description: \"fetch the doctors from this postal code\",\n      }\n    },\n    required: [\"postal_code\"],\n  },\n}\n\nconst controlLightFunctionDeclaration = {\n  name: \"controlLight\",\n  parameters: {\n    type: \"OBJECT\",\n    description: \"Set the brightness and color temperature of a room light.\",\n    properties: {\n      brightness: {\n        type: \"NUMBER\",\n        description: \"Light level from 0 to 100. Zero is off and 100 is full brightness.\",\n      },\n      colorTemperature: {\n        type: \"STRING\",\n        description: \"Color temperature of the light fixture which can be `daylight`, `cool` or `warm`.\",\n      },\n    },\n    required: [\"brightness\", \"colorTemperature\"],\n  },\n};\n\nconst functions = {\n  controlLight: ({ brightness, colorTemperature }: { brightness: number; colorTemperature: string }) => {\n    return setLightValues(brightness, colorTemperature);\n  },\n  getDoctorsFromPostalCode: ({ postal_code }: { postal_code : string; }) => {\n    return fetchDoctors(postal_code);\n  },\n  \n};\n\n// Remove unused system_instruction or use it\n// const system_instruction = \"You are a medical assistant chatbot\";\n\nexport class GeminiWebSocket {\n  private ws: WebSocket | null = null;\n  private isConnected: boolean = false;\n  private isSetupComplete: boolean = false;\n  private onMessageCallback: ((text: string) => void) | null = null;\n  private onSetupCompleteCallback: (() => void) | null = null;\n  private audioContext: AudioContext | null = null;\n  \n  // Audio queue management\n  private audioQueue: Float32Array[] = [];\n  private isPlaying: boolean = false;\n  private currentSource: AudioBufferSourceNode | null = null;\n  private isPlayingResponse: boolean = false;\n  private onPlayingStateChange: ((isPlaying: boolean) => void) | null = null;\n  private onAudioLevelChange: ((level: number) => void) | null = null;\n  private onTranscriptionCallback: ((text: string) => void) | null = null;\n  private transcriptionService: TranscriptionService;\n  private accumulatedPcmData: string[] = [];\n\n  constructor(\n    onMessage: (text: string) => void, \n    onSetupComplete: () => void,\n    onPlayingStateChange: (isPlaying: boolean) => void,\n    onAudioLevelChange: (level: number) => void,\n    onTranscription: (text: string) => void\n  ) {\n    this.onMessageCallback = onMessage;\n    this.onSetupCompleteCallback = onSetupComplete;\n    this.onPlayingStateChange = onPlayingStateChange;\n    this.onAudioLevelChange = onAudioLevelChange;\n    this.onTranscriptionCallback = onTranscription;\n    // Create AudioContext for playback\n    this.audioContext = new AudioContext({\n      sampleRate: 24000  // Match the response audio rate\n    });\n    this.transcriptionService = new TranscriptionService();\n  }\n\n  connect() {\n    if (this.ws?.readyState === WebSocket.OPEN) {\n      return;\n    }\n    \n    this.ws = new WebSocket(WS_URL);\n\n    this.ws.onopen = () => {\n      this.isConnected = true;\n      this.sendInitialSetup();\n    };\n\n    this.ws.onmessage = async (event) => {\n      try {\n        let messageText: string;\n        if (event.data instanceof Blob) {\n          const arrayBuffer = await event.data.arrayBuffer();\n          const bytes = new Uint8Array(arrayBuffer);\n          messageText = new TextDecoder('utf-8').decode(bytes);\n        } else {\n          messageText = event.data;\n        }\n        \n        await this.handleMessage(messageText);\n      } catch (error) {\n        console.error(\"[WebSocket] Error processing message:\", error);\n      }\n    };\n\n    this.ws.onerror = (error) => {\n      console.error(\"[WebSocket] Error:\", error);\n    };\n\n    this.ws.onclose = (event) => {\n      this.isConnected = false;\n      \n      // Only attempt to reconnect if we haven't explicitly called disconnect\n      if (!event.wasClean && this.isSetupComplete) {\n        setTimeout(() => this.connect(), 1000);\n      }\n    };\n  }\n\n  private sendInitialSetup() {\n    const setupMessage = {\n      setup: {\n        model: MODEL,\n        generation_config: {\n          response_modalities: [\"AUDIO\"] \n        },\n        tools: {\n          functionDeclarations: [controlLightFunctionDeclaration, fetchDoctorsDeclaration],\n        },\n        // system_instruction: system_instruction\n      }\n    };\n    this.ws?.send(JSON.stringify(setupMessage));\n  }\n\n  sendMediaChunk(b64Data: string, mimeType: string) {\n    if (!this.isConnected || !this.ws || !this.isSetupComplete) return;\n\n    const message = {\n      realtime_input: {\n        media_chunks: [{\n          mime_type: mimeType === \"audio/pcm\" ? \"audio/pcm\" : mimeType,\n          data: b64Data\n        }]\n      }\n    };\n\n    try {\n      this.ws.send(JSON.stringify(message));\n    } catch (error) {\n      console.error(\"[WebSocket] Error sending media chunk:\", error);\n    }\n  }\n\n  private async playAudioResponse(base64Data: string) {\n    if (!this.audioContext) return;\n\n    try {\n      // Decode base64 to bytes\n      const binaryString = atob(base64Data);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n\n      // Convert to Int16Array (PCM format)\n      const pcmData = new Int16Array(bytes.buffer);\n      \n      // Convert to float32 for Web Audio API\n      const float32Data = new Float32Array(pcmData.length);\n      for (let i = 0; i < pcmData.length; i++) {\n        float32Data[i] = pcmData[i] / 32768.0;\n      }\n\n      // Add to queue and start playing if not already playing\n      this.audioQueue.push(float32Data);\n      this.playNextInQueue();\n    } catch (error) {\n      console.error(\"[WebSocket] Error processing audio:\", error);\n    }\n  }\n\n  private async playNextInQueue() {\n    if (!this.audioContext || this.isPlaying || this.audioQueue.length === 0) return;\n\n    try {\n      this.isPlaying = true;\n      this.isPlayingResponse = true;\n      this.onPlayingStateChange?.(true);\n      const float32Data = this.audioQueue.shift()!;\n\n      // Calculate audio level\n      let sum = 0;\n      for (let i = 0; i < float32Data.length; i++) {\n        sum += Math.abs(float32Data[i]);\n      }\n      const level = Math.min((sum / float32Data.length) * 100 * 5, 100);\n      this.onAudioLevelChange?.(level);\n\n      const audioBuffer = this.audioContext.createBuffer(\n        1,\n        float32Data.length,\n        24000\n      );\n      audioBuffer.getChannelData(0).set(float32Data);\n\n      this.currentSource = this.audioContext.createBufferSource();\n      this.currentSource.buffer = audioBuffer;\n      this.currentSource.connect(this.audioContext.destination);\n      \n      this.currentSource.onended = () => {\n        this.isPlaying = false;\n        this.currentSource = null;\n        if (this.audioQueue.length === 0) {\n          this.isPlayingResponse = false;\n          this.onPlayingStateChange?.(false);\n        }\n        this.playNextInQueue();\n      };\n\n      this.currentSource.start();\n    } catch (error) {\n      console.error(\"[WebSocket] Error playing audio:\", error);\n      this.isPlaying = false;\n      this.isPlayingResponse = false;\n      this.onPlayingStateChange?.(false);\n      this.currentSource = null;\n      this.playNextInQueue();\n    }\n  }\n\n  private stopCurrentAudio() {\n    if (this.currentSource) {\n      try {\n        this.currentSource.stop();\n      } catch {  // Remove _e parameter since it's not used\n        // Ignore errors if already stopped\n      }\n      this.currentSource = null;\n    }\n    this.isPlaying = false;\n    this.isPlayingResponse = false;\n    this.onPlayingStateChange?.(false);\n    this.audioQueue = []; // Clear queue\n  }\n\n  private async handleMessage(message: string) {\n    try {\n      const messageData = JSON.parse(message);\n\n      console.log(\"messageData: \",  messageData)\n      console.log(messageData.toolCall?.functionCalls)\n\n      if (messageData.toolCall?.functionCalls) {\n        // If the server sends multiple function calls in an array, handle them all\n        for (const funcCall of messageData.toolCall.functionCalls) {\n          if (funcCall.name === \"controlLight\") {\n            const { args, id } = funcCall;\n            // Call our actual JS function with the args\n            const result = await functions.controlLight(args);\n      \n            // Build a response object to send back\n            const responseMessage = {\n              functionResponse: {\n                name: \"controlLight\",\n                response: result,\n                id, // pass along the call's ID if needed\n              }\n            };\n            this.ws?.send(JSON.stringify(responseMessage));\n            console.log(\"[Tool Response]:\", result);\n      \n            // If you only expect one function call at a time, you can return after\n            // processing the first. Otherwise, remove this return if you want to\n            // handle multiple calls in one message.\n            return;\n          }\n          else if(funcCall.name === \"getDoctorsFromPostalCode\"){\n            const { args, id } = funcCall;\n            const result = await functions.getDoctorsFromPostalCode(args);\n            const responseMessage = {\n              functionResponse: {\n                name: \"getDoctorsFromPostalCode\",\n                response: result,\n                id, // pass along the call's ID if needed\n              }\n            };\n            this.ws?.send(JSON.stringify(responseMessage));\n            console.log(\"[Tool Response]:\", result);\n          }\n        }\n      }\n      \n      if (messageData.setupComplete) {\n        this.isSetupComplete = true;\n        this.onSetupCompleteCallback?.();\n        return;\n      }\n\n      // Handle audio data\n      if (messageData.serverContent?.modelTurn?.parts) {\n        const parts = messageData.serverContent.modelTurn.parts;\n        for (const part of parts) {\n          if (part.inlineData?.mimeType === \"audio/pcm;rate=24000\") {\n            this.accumulatedPcmData.push(part.inlineData.data);\n            this.playAudioResponse(part.inlineData.data);\n          }\n        }\n      }\n\n      // Handle turn completion separately\n      if (messageData.serverContent?.turnComplete === true) {\n        if (this.accumulatedPcmData.length > 0) {\n          try {\n            const fullPcmData = this.accumulatedPcmData.join('');\n            const wavData = await pcmToWav(fullPcmData, 24000);\n            \n            const transcription = await this.transcriptionService.transcribeAudio(\n              wavData,\n              \"audio/wav\"\n            );\n            console.log(\"[Transcription]:\", transcription);\n\n            this.onTranscriptionCallback?.(transcription);\n            this.accumulatedPcmData = []; // Clear accumulated data\n          } catch (error) {\n            console.error(\"[WebSocket] Transcription error:\", error);\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"[WebSocket] Error parsing message:\", error);\n    }\n  }\n\n  disconnect() {\n    this.isSetupComplete = false;\n    if (this.ws) {\n      this.ws.close(1000, \"Intentional disconnect\");\n      this.ws = null;\n    }\n    this.isConnected = false;\n    this.accumulatedPcmData = [];\n  }\n} "],"names":[],"mappings":"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"}},
    {"offset": {"line": 513, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 519, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/app/hooks/useMediaCapture.ts"],"sourcesContent":["import { useRef, useState, useCallback, useEffect } from 'react';\nimport { Base64 } from 'js-base64';\nimport { GeminiWebSocket } from '../services/geminiWebSocket';\n\nexport const useMediaCapture = (onTranscription: (text: string) => void) => {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [stream, setStream] = useState<MediaStream | null>(null);\n  const [audioLevel, setAudioLevel] = useState(0);\n  const geminiWsRef = useRef<GeminiWebSocket | null>(null);\n  const videoCanvasRef = useRef<HTMLCanvasElement>(null);\n  const audioWorkletNodeRef = useRef<AudioWorkletNode | null>(null);\n  const [isAudioSetup, setIsAudioSetup] = useState(false);\n  const setupInProgressRef = useRef(false);\n  const [isWebSocketReady, setIsWebSocketReady] = useState(false);\n  const imageIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const [isModelSpeaking, setIsModelSpeaking] = useState(false);\n  const [outputAudioLevel, setOutputAudioLevel] = useState(0);\n  const [connectionStatus, setConnectionStatus] = useState<'disconnected' | 'connecting' | 'connected'>('disconnected');\n  const [isAudioOnly, setIsAudioOnly] = useState(false);\n\n  const cleanupAudio = useCallback(() => {\n    if (audioWorkletNodeRef.current) {\n      audioWorkletNodeRef.current.disconnect();\n      audioWorkletNodeRef.current = null;\n    }\n    if (audioContextRef.current) {\n      audioContextRef.current.close();\n      audioContextRef.current = null;\n    }\n  }, []);\n\n  const cleanupWebSocket = useCallback(() => {\n    if (geminiWsRef.current) {\n      geminiWsRef.current.disconnect();\n      geminiWsRef.current = null;\n    }\n  }, []);\n\n  const sendAudioData = (b64Data: string) => {\n    if (!geminiWsRef.current) return;\n    geminiWsRef.current.sendMediaChunk(b64Data, \"audio/pcm\");\n  };\n\n  const startAudioOnly = async () => {\n    if (isStreaming) return;\n    \n    try {\n      const audioStream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          sampleRate: 16000,\n          channelCount: 1,\n          echoCancellation: true,\n          autoGainControl: true,\n          noiseSuppression: true,\n        }\n      });\n\n      audioContextRef.current = new AudioContext({\n        sampleRate: 16000,\n      });\n\n      setStream(audioStream);\n      setIsStreaming(true);\n      setIsAudioOnly(true);\n    } catch (err) {\n      console.error('Error accessing audio device:', err);\n      cleanupAudio();\n    }\n  };\n\n  const toggleAudio = async () => {\n    if (isStreaming) {\n      setIsStreaming(false);\n      cleanupWebSocket();\n      cleanupAudio();\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n      }\n      if (videoRef.current) {\n        videoRef.current.srcObject = null;\n      }\n      setStream(null);\n      setIsAudioOnly(false);\n    } else {\n      await startAudioOnly();\n    }\n  };\n\n  const toggleCamera = async () => {\n    if (isStreaming && stream) {\n      setIsStreaming(false);\n      cleanupWebSocket();\n      cleanupAudio();\n      stream.getTracks().forEach(track => track.stop());\n      if (videoRef.current) {\n        videoRef.current.srcObject = null;\n      }\n      setStream(null);\n      setIsAudioOnly(false);\n    } else {\n      try {\n        const videoStream = await navigator.mediaDevices.getUserMedia({ \n          video: true,\n          audio: false\n        });\n\n        const audioStream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            sampleRate: 16000,\n            channelCount: 1,\n            echoCancellation: true,\n            autoGainControl: true,\n            noiseSuppression: true,\n          }\n        });\n\n        audioContextRef.current = new AudioContext({\n          sampleRate: 16000,\n        });\n\n        if (videoRef.current) {\n          videoRef.current.srcObject = videoStream;\n          videoRef.current.muted = true;\n        }\n\n        const combinedStream = new MediaStream([\n          ...videoStream.getTracks(),\n          ...audioStream.getTracks()\n        ]);\n\n        setStream(combinedStream);\n        setIsStreaming(true);\n        setIsAudioOnly(false);\n      } catch (err) {\n        console.error('Error accessing media devices:', err);\n        cleanupAudio();\n      }\n    }\n  };\n\n  const captureAndSendImage = useCallback(() => {\n    if (!videoRef.current || !videoCanvasRef.current || !geminiWsRef.current) return;\n\n    const canvas = videoCanvasRef.current;\n    const context = canvas.getContext('2d');\n    if (!context) return;\n\n    canvas.width = videoRef.current.videoWidth;\n    canvas.height = videoRef.current.videoHeight;\n    context.drawImage(videoRef.current, 0, 0);\n\n    const imageData = canvas.toDataURL('image/jpeg', 0.8);\n    const b64Data = imageData.split(',')[1];\n    geminiWsRef.current.sendMediaChunk(b64Data, \"image/jpeg\");\n  }, []);\n\n  // WebSocket connection effect\n  useEffect(() => {\n    if (!isStreaming) {\n      setConnectionStatus('disconnected');\n      return;\n    }\n\n    setConnectionStatus('connecting');\n    geminiWsRef.current = new GeminiWebSocket(\n      (text) => {\n        console.log(\"Received from Gemini:\", text);\n      },\n      () => {\n        console.log(\"[Camera] WebSocket setup complete, starting media capture\");\n        setIsWebSocketReady(true);\n        setConnectionStatus('connected');\n      },\n      (isPlaying) => {\n        setIsModelSpeaking(isPlaying);\n      },\n      (level) => {\n        setOutputAudioLevel(level);\n      },\n      onTranscription\n    );\n    geminiWsRef.current.connect();\n\n    return () => {\n      if (imageIntervalRef.current) {\n        clearInterval(imageIntervalRef.current);\n        imageIntervalRef.current = null;\n      }\n      cleanupWebSocket();\n      setIsWebSocketReady(false);\n      setConnectionStatus('disconnected');\n    };\n  }, [isStreaming, onTranscription, cleanupWebSocket]);\n\n  // Image capture interval effect\n  useEffect(() => {\n    if (!isStreaming || !isWebSocketReady) return;\n\n    console.log(\"[Camera] Starting image capture interval\");\n    imageIntervalRef.current = setInterval(captureAndSendImage, 1000);\n\n    return () => {\n      if (imageIntervalRef.current) {\n        clearInterval(imageIntervalRef.current);\n        imageIntervalRef.current = null;\n      }\n    };\n  }, [isStreaming, isWebSocketReady, captureAndSendImage]);\n\n  // Audio processing setup effect\n  useEffect(() => {\n    if (!isStreaming || !stream || !audioContextRef.current || \n        !isWebSocketReady || isAudioSetup || setupInProgressRef.current) {\n      return;\n    }\n\n    let isActive = true;\n    setupInProgressRef.current = true;\n\n    const setupAudioProcessing = async () => {\n      try {\n        const ctx = audioContextRef.current;\n        if (!ctx || ctx.state === 'closed' || !isActive) {\n          setupInProgressRef.current = false;\n          return;\n        }\n\n        if (ctx.state === 'suspended') {\n          await ctx.resume();\n        }\n\n        await ctx.audioWorklet.addModule('/worklets/audio-processor.js');\n\n        if (!isActive) {\n          setupInProgressRef.current = false;\n          return;\n        }\n\n        audioWorkletNodeRef.current = new AudioWorkletNode(ctx, 'audio-processor', {\n          numberOfInputs: 1,\n          numberOfOutputs: 1,\n          processorOptions: {\n            sampleRate: 16000,\n            bufferSize: 4096,\n          },\n          channelCount: 1,\n          channelCountMode: 'explicit',\n          channelInterpretation: 'speakers'\n        });\n\n        const source = ctx.createMediaStreamSource(stream);\n        audioWorkletNodeRef.current.port.onmessage = (event) => {\n          if (!isActive || isModelSpeaking) return;\n          const { pcmData, level } = event.data;\n          setAudioLevel(level);\n\n          const pcmArray = new Uint8Array(pcmData);\n          const b64Data = Base64.fromUint8Array(pcmArray);\n          sendAudioData(b64Data);\n        };\n\n        source.connect(audioWorkletNodeRef.current);\n        setIsAudioSetup(true);\n        setupInProgressRef.current = false;\n      } catch (error) {\n        if (isActive) {\n          console.error(error);\n          cleanupAudio();\n          setIsAudioSetup(false);\n        }\n        setupInProgressRef.current = false;\n      }\n    };\n\n    console.log(\"[Camera] Starting audio processing setup\");\n    setupAudioProcessing();\n\n    return () => {\n      isActive = false;\n      setIsAudioSetup(false);\n      setupInProgressRef.current = false;\n      if (audioWorkletNodeRef.current) {\n        audioWorkletNodeRef.current.disconnect();\n        audioWorkletNodeRef.current = null;\n      }\n    };\n  }, [isStreaming, stream, isWebSocketReady, isModelSpeaking, cleanupAudio, isAudioSetup]);\n\n  return {\n    videoRef,\n    videoCanvasRef,\n    isStreaming,\n    isAudioOnly,\n    connectionStatus,\n    audioLevel,\n    isModelSpeaking,\n    outputAudioLevel,\n    toggleCamera,\n    toggleAudio\n  };\n}; "],"names":[],"mappings":"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"}},
    {"offset": {"line": 834, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 840, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/app/components/CameraPreview.tsx"],"sourcesContent":["\"use client\";\n\nimport { forwardRef, useImperativeHandle } from 'react';\nimport { useMediaCapture } from '../hooks/useMediaCapture';\n\ninterface CameraPreviewProps {\n  onTranscription: (text: string) => void;\n}\n\nexport interface CameraPreviewHandles {\n  toggleCamera: () => Promise<void> | void;\n  toggleAudio: () => Promise<void> | void;\n  isStreaming: boolean;\n  isAudioOnly: boolean;\n  connectionStatus: string;\n  audioLevel: number;\n  isModelSpeaking: boolean;\n  outputAudioLevel: number;\n}\n\nconst CameraPreview = forwardRef<CameraPreviewHandles, CameraPreviewProps>(\n  ({ onTranscription }, ref) => {\n    const {\n      videoRef,\n      videoCanvasRef,\n      isStreaming,\n      isAudioOnly,\n      connectionStatus,\n      audioLevel,\n      isModelSpeaking,\n      outputAudioLevel,\n      toggleCamera,\n      toggleAudio\n    } = useMediaCapture(onTranscription);\n\n    useImperativeHandle(ref, () => ({\n      toggleCamera,\n      toggleAudio,\n      isStreaming,\n      isAudioOnly,\n      connectionStatus,\n      audioLevel,\n      isModelSpeaking,\n      outputAudioLevel,\n    }));\n\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"relative\">\n          <video\n            ref={videoRef}\n            autoPlay\n            playsInline\n            className=\"w-[200px] h-[133px] bg-muted rounded-lg overflow-hidden\"\n          />\n          \n          {/* Connection Status Overlay */}\n          {isStreaming && connectionStatus !== 'connected' && (\n            <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg backdrop-blur-sm\">\n              <div className=\"text-center space-y-2\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto\" />\n                <p className=\"text-white font-medium\">\n                  {connectionStatus === 'connecting' ? 'Connecting to Gemini...' : 'Disconnected'}\n                </p>\n                <p className=\"text-white/70 text-sm\">\n                  Please wait while we establish a secure connection\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n        {isStreaming && (\n          <div className=\"w-[200px] h-2 rounded-full bg-green-100\">\n            <div\n              className=\"h-full rounded-full transition-all bg-green-500\"\n              style={{ \n                width: `${isModelSpeaking ? outputAudioLevel : audioLevel}%`,\n                transition: 'width 100ms ease-out'\n              }}\n            />\n          </div>\n        )}\n        <canvas ref={videoCanvasRef} className=\"hidden\" />\n      </div>\n    );\n  }\n);\n\nCameraPreview.displayName = 'CameraPreview';\n\nexport default CameraPreview;\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAHA;;;AAoBA,MAAM,8BAAgB,GAAA,CAAA,GAAA,6JAAA,CAAA,aAAU,AAAD,UAC7B,CAAC,EAAE,eAAe,EAAE,EAAE;;IACpB,MAAM,EACJ,QAAQ,EACR,cAAc,EACd,WAAW,EACX,WAAW,EACX,gBAAgB,EAChB,UAAU,EACV,eAAe,EACf,gBAAgB,EAChB,YAAY,EACZ,WAAW,EACZ,GAAG,CAAA,GAAA,kIAAA,CAAA,kBAAe,AAAD,EAAE;IAEpB,CAAA,GAAA,6JAAA,CAAA,sBAAmB,AAAD,EAAE;6CAAK,IAAM,CAAC;gBAC9B;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACF,CAAC;;IAED,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,KAAK;wBACL,QAAQ;wBACR,WAAW;wBACX,WAAU;;;;;;oBAIX,eAAe,qBAAqB,6BACnC,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;;;;;8CACf,6LAAC;oCAAE,WAAU;8CACV,qBAAqB,eAAe,4BAA4B;;;;;;8CAEnE,6LAAC;oCAAE,WAAU;8CAAwB;;;;;;;;;;;;;;;;;;;;;;;YAO5C,6BACC,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBACC,WAAU;oBACV,OAAO;wBACL,OAAO,GAAG,kBAAkB,mBAAmB,WAAW,CAAC,CAAC;wBAC5D,YAAY;oBACd;;;;;;;;;;;0BAIN,6LAAC;gBAAO,KAAK;gBAAgB,WAAU;;;;;;;;;;;;AAG7C;;QApDM,kIAAA,CAAA,kBAAe;;;;QAAf,kIAAA,CAAA,kBAAe;;;;AAuDvB,cAAc,WAAW,GAAG;uCAEb"}},
    {"offset": {"line": 977, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 983, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,8JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,wIAAA,CAAA,OAAI,AAAD,EAAE;AACtB"}},
    {"offset": {"line": 996, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1002, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/components/ui/scroll-area.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n"],"names":[],"mappings":";;;;;AAEA;AAGA;AAFA;AAHA;;;;;AAOA,MAAM,2BAAa,8JAAM,UAAU,MAGjC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,6LAAC,8KAAoB,IAAI;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EAAE,4BAA4B;QACzC,GAAG,KAAK;;0BAET,6LAAC,8KAAoB,QAAQ;gBAAC,WAAU;0BACrC;;;;;;0BAEH,6LAAC;;;;;0BACD,6LAAC,8KAAoB,MAAM;;;;;;;;;;;;AAG/B,WAAW,WAAW,GAAG,8KAAoB,IAAI,CAAC,WAAW;AAE7D,MAAM,0BAAY,8JAAM,UAAU,CAGhC,CAAC,EAAE,SAAS,EAAE,cAAc,UAAU,EAAE,GAAG,OAAO,EAAE,oBACpD,6LAAC,8KAAoB,mBAAmB;QACtC,KAAK;QACL,aAAa;QACb,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,iDACA,gBAAgB,cACd,sDACF,gBAAgB,gBACd,wDACF;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,8KAAoB,eAAe;YAAC,WAAU;;;;;;;;;;;MAjB7C;AAoBN,UAAU,WAAW,GAAG,8KAAoB,mBAAmB,CAAC,WAAW"}},
    {"offset": {"line": 1073, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1079, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/components/ui/avatar.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n"],"names":[],"mappings":";;;;;;AAEA;AAGA;AAFA;AAHA;;;;;AAOA,MAAM,uBAAS,8JAAM,UAAU,MAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,sKAAgB,IAAI;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,iEACA;QAED,GAAG,KAAK;;;;;;;AAGb,OAAO,WAAW,GAAG,sKAAgB,IAAI,CAAC,WAAW;AAErD,MAAM,4BAAc,8JAAM,UAAU,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,sKAAgB,KAAK;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EAAE,+BAA+B;QAC5C,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,sKAAgB,KAAK,CAAC,WAAW;AAE3D,MAAM,+BAAiB,8JAAM,UAAU,OAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,sKAAgB,QAAQ;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,wEACA;QAED,GAAG,KAAK;;;;;;;AAGb,eAAe,WAAW,GAAG,sKAAgB,QAAQ,CAAC,WAAW"}},
    {"offset": {"line": 1137, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1143, "column": 0}, "map": {"version":3,"sources":["file:///Users/srinivasaperisetla/HealthInnovatorsAI/gemini-nextjs/app/page.tsx"],"sourcesContent":["// app/page.tsx\n\"use client\";\nimport { useState, useCallback, useRef } from 'react';\nimport CameraPreview from './components/CameraPreview';\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Mic, Camera, ArrowUp } from \"lucide-react\";\nimport { CameraPreviewHandles } from './types/camera';\n\n// Helper function to create message components\nconst HumanMessage = ({ text }: { text: string }) => (\n  <div className=\"flex gap-3 items-start\">\n    <Avatar className=\"h-8 w-8\">\n      <AvatarImage src=\"/avatars/human.png\" alt=\"Human\" />\n      <AvatarFallback>H</AvatarFallback>\n    </Avatar>\n    <div className=\"flex-1 space-y-2\">\n      <div className=\"flex items-center gap-2\">\n        <p className=\"text-sm font-medium text-zinc-900\">You</p>\n      </div>\n      <div className=\"rounded-lg bg-zinc-100 px-3 py-2 text-sm text-zinc-800\">\n        {text}\n      </div>\n    </div>\n  </div>\n);\n\nconst GeminiMessage = ({ text }: { text: string }) => (\n  <div className=\"flex gap-3 items-start\">\n    <Avatar className=\"h-8 w-8 bg-blue-600\">\n      <AvatarImage src=\"/avatars/gemini.png\" alt=\"Gemini\" />\n      <AvatarFallback>AI</AvatarFallback>\n    </Avatar>\n    <div className=\"flex-1 space-y-2\">\n      <div className=\"flex items-center gap-2\">\n        <p className=\"text-sm font-medium text-zinc-900\">Gemini</p>\n      </div>\n      <div className=\"rounded-lg bg-white px-3 py-2 text-sm text-zinc-800\">\n        {text}\n      </div>\n    </div>\n  </div>\n);\n\nexport default function Home() {\n  \n  const [messages, setMessages] = useState<{ type: 'human' | 'gemini', text: string }[]>([]);\n  const [isAudioActive, setIsAudioActive] = useState(false);\n  const [isCameraActive, setIsCameraActive] = useState(false);\n  const cameraRef = useRef<CameraPreviewHandles>(null);\n\n  const handleTranscription = useCallback((transcription: string) => {\n    setMessages(prev => [...prev, { type: 'gemini', text: transcription }]);\n  }, []);\n\n  const handleToggleCamera = () => {\n    if (cameraRef.current) {\n      cameraRef.current.toggleCamera();\n      if (!isCameraActive && !isAudioActive) {\n        // If turning on camera from completely off state\n        setIsAudioActive(true);\n        setIsCameraActive(true);\n      } else {\n        setIsCameraActive(!isCameraActive);\n        if (isCameraActive) {\n          // If turning off camera, also turn off audio\n          setIsAudioActive(false);\n        }\n      }\n    }\n  };\n\n  const handleToggleAudio = () => {\n    if (cameraRef.current) {\n      cameraRef.current.toggleAudio();\n      setIsAudioActive(!isAudioActive);\n      if (isCameraActive && isAudioActive) {\n        // If turning off audio while camera is on, also turn off camera\n        setIsCameraActive(false);\n      }\n    }\n  };\n\n  return (\n    <div className=\"flex h-screen w-full\">\n    {/* Sidebar */}\n    <aside className=\"w-1/5 bg-zinc-100 p-6 border-r border-zinc-300\">\n      <h2 className=\"text-2xl font-bold text-zinc-800 mb-4\">\n        Health Innovators AI Chatbot\n      </h2>\n      {/* You can add additional sidebar items or navigation here */}\n    </aside>\n\n    {/* Main Chat Area */}\n    <main className=\"flex-1 flex flex-col \">\n      {/* Chat Window */}\n      <div className=\"flex-1 p-2 overflow-hidden \">\n        <div className=\"mx-auto max-w-full bg-white rounded-lg flex flex-col h-full w-full justify-center items-center\">\n\n          <h2 className=\"text-2xl font-bold text-zinc-800 mb-6 m-6\">\n            Health Innovators AI Chatbot\n          </h2>\n\n          \n          <ScrollArea className=\"flex-1 p-6 w-10/12\">\n\n            <div className=\"space-y-4\">\n              <GeminiMessage text=\"Hi! I'm Gemini. I can see and hear you. Let's chat!\" />\n              {messages.map((message, index) =>\n                message.type === 'human' ? (\n                  <HumanMessage key={`msg-${index}`} text={message.text} />\n                ) : (\n                  <GeminiMessage key={`msg-${index}`} text={message.text} />\n                )\n              )}\n            </div>\n\n            <div className='absolute bottom-4 right-4 z-10'> \n              <CameraPreview ref={cameraRef} onTranscription={handleTranscription} />\n            </div>\n            \n          </ScrollArea>\n          \n          {/* Input Area */}\n          <div className=\"p-4 bg-zinc-100 rounded-xl mb-9 w-10/12\">\n            <div className=\"flex flex-col items-center\">\n\n              <input\n                type=\"text\"\n                placeholder=\"Type your message...\"\n                className=\"w-full p-3 rounded-xl bg-zinc-100 focus:outline-none focus:ring-0\"\n              />\n\n              <div className=\"flex w-full\"> \n\n                <button \n                  className={`px-3 text-2xl font-bold rounded-full transition-colors ${\n                    isAudioActive ? 'text-black' : 'text-zinc-400 hover:text-black'\n                  }`}\n                  onClick={handleToggleAudio}\n                >\n                  <Mic size={20} />\n                </button>\n\n                <button \n                  className={`px-3 text-2xl font-bold rounded-full transition-colors ${\n                    isCameraActive ? 'text-black' : 'text-zinc-400 hover:text-black'\n                  }`}\n                  onClick={handleToggleCamera}\n                >\n                  <Camera size={20} />\n                </button>\n\n                {/* <button className=\"px-3 text-2xl font-bold text-zinc-400 rounded-full hover:text-green\">\n                  <Monitor size={20} />\n                </button> */}\n                \n                <button className=\"ml-auto p-2 text-2xl font-bold border border-zinc-400 text-zinc-400 rounded-full hover:text-black hover:border-black\">\n                  <ArrowUp size={32} />\n                </button>\n\n              </div>\n              \n            </div>\n          </div>\n\n        </div>\n      </div>\n\n    </main>\n  </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1537, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}